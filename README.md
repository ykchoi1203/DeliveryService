# 주문 배달 서비스 API
음식을 주문하고 리뷰를 남길 수 있는 서비스

# 개발 환경
- Framework: Spring Boot
- Persistence: JPA
- Language: Java
- Build Tool: Gradle
- Database: MariaDB, ( 1 순위 )
 elasticsearch ( 2 순위. 추후 검색에서 활용 )
- IDEA : IntelliJ
- 결제 api : 카카오페이 api
- 시간이 된다면 주소부분에서 도로명 주소 api 활용.
- 시간이 된다면 주소부분에서 카카오 맵 api를 통해 도로명 주소를 위도,경도 값으로 변환 후 설정 반경(5km) 안의 가게들로만 조회가 되도록 변경.


# 프로젝트 기능 및 설계
  
## 일반 회원 /user
- [ ] 회원가입
  - POST /register
  - 사용자는 회원가입 할 수 있다. 일빈 회원은 회원가입 시 USER 권한을 가진다.
  - 회원가입 시 아이디, 비밀번호, 닉네임, 핸드폰 번호, 이메일을 입력받으며, 비밀번호를 제외한 값들은 unique 해야한다.
  - 소셜 회원가입 시 유저 아이디와 비밀번호는 자동 생성되며, 소셜 아이디, 닉네임, 핸드폰 번호, 이메일을 입력받으며, 해당 값들은 unique 해야한다.
    
- [ ] 일반 로그인
  - POST /login
  - 사용자는 로그인 할 수 있다. 로그인 시 아이디와 패스워드가 일치해야 한다.
     
- [ ] 소셜 로그인
  - POST /login/social
  - 사용자는 소셜 로그인 할 수 있다. 카카오 / 구글 로그인에 성공 후, 해당 소셜 아이디가 존재한다면 로그인 성공. 해당 소셜 아이디가 존재하지 않는다면 회원가입 페이지로 넘어간다.

- [ ] 로그아웃
  - POST /logout
  - 사용자는 로그아웃 할 수 있다. 해당 토큰은 블렉리스트 처리한다.

- [ ] 프로필 수정
  - PUT /profile
  - 사용자는 프로필을 수정 할 수 있다. 비밀번호, 닉네임, 핸드폰 번호, 이메일을 입력 받는다.

- [ ] 회원 탈퇴
  - PUT /account
  - 사용자는 탈퇴를 할 수 있다. 탈퇴에 성공하면 삭제 날짜를 업데이트 한다.
     
- [ ] 배달 주소 조회
  - GET /addresses
  - 사용자는 배달 주소를 조회 할 수 있다.
  - 해당 아이디의 등록된 주소 중 기본 주소 설정이 true인 값이 존재하는 경우 등록에 실패한다.

- [ ] 배달 주소 등록
  - POST /addresses
  - 사용자는 최대 5개까지의 배달 주소를 등록 할 수 있다. 배달 주소, 배달지 이름, 기본 주소로 설정하는지의 여부를 입력받는다.
  - 해당 아이디의 등록된 주소 중 기본 주소 설정이 true인 값이 존재하는 경우 등록에 실패한다.

- [ ] 배달 주소 수정
  - PUT /addresses
  - 사용자는 배달 주소를 수정 할 수 있다. 배달 주소, 배달지 이름, 기본 주소로 설정하는지의 여부를 입력받는다.
  - 해당 아이디의 등록된 주소 중 기본 주소 설정이 true인 값이 존재하는 경우 등록에 실패한다.

- [ ] 배달 주소 삭제
  - DELETE /addresses
  - 사용자는 배달 주소를 삭제 할 수 있다. 해당 주소가 기본 주소로 설정되어 있었다면, 가장 최근에 등록한 주소가 기본 주소 값으로 설정된다.

- [ ] 메뉴 검색
  - GET /search?menu={menuName}
  - 사용자는 메뉴 이름을 검색 할 수 있다. 해당 메뉴가 있는 가게들을 보여준다.
  - 평점 순, 이름 순, 배달비 순으로 설정 할 수 있다.
  - 페이징 처리를 통해 한번에 10개씩 조회 할 수 있다.

- [ ] 가게 검색
  - GET /search?store={storeName}
  - 사용자는 가게 이름을 검색 할 수 있다. 현재 기본 주소로 되어있는 동/면 에 있는 가게들 중 관리자가 허가를 내준 가게만 조회할 수 있다. 
  - 가게가 영업중인 상태만 조회 가능 하며, 정렬 순서는 평점 순, 이름 순, 배달비 순으로 설정 할 수 있다.
  - 페이징 처리를 통해 한번에 10개씩 조회 할 수 있다.

- [ ] 카테고리 검색
  - GET /search?category={categoryId}
  - 사용자는 카테고리에 해당되는 가게를 검색 할 수 있다.
  - 평점 순, 이름 순, 배달비 순으로 설정 할 수 있다.
  - 페이징 처리를 통해 한번에 10개씩 조회 할 수 있다.

- [ ] 가게 상세 조회
  - GET /search/detail?store={storeId}
  - 사용자는 해당되는 가게의 메뉴를 조회 할 수 있다.

- [ ] 메뉴 상세 조회
  - GET /search/detail?menu={menuId}
  - 사용자는 해당되는 가게의 메뉴를 상세 조회 할 수 있다. 추가 메뉴가 있으면 추가 메뉴도 같이 조회된다.

- [ ] 장바구니 추가
  - POST /cart
  - 사용자는 메뉴를 장바구니에 추가할 수 있다. 장바구니에는 같은 가게의 메뉴만 추가할 수 있다.
  - 해당 가게인지는 캐싱을 통해 판단한다.
  - 해당 메뉴의 추가 메뉴도 추가할 수 있다.

- [ ] 장바구니 삭제
  - DELETE /cart
  - 사용자는 메뉴를 장바구니에서 삭제할 수 있다. 해당 메뉴의 추가메뉴가 장바구니에 있는 경우 추가메뉴도 같이 삭제된다.
  - 해당 메뉴의 추가 메뉴만 삭제할 수 있다.

- [ ] 주문
  - POST /orderTable
  - 사용자는 주문할 수 있다. 요청 사항을 입력받는다. 가게의 최소 주문 금액보다 총 주문 금액이 작다면 주문 할 수 없다.

- [ ] 결제
  - POST /payments
  - 사용자는 주문한 메뉴들을 결제할 수 있다. 결제가 승인이 된다면 주문의 상태가 결제완료로 바뀐다.
  - 주문 상태가 결제 완료로 바뀌면 장바구니에 있는 메뉴들을 주문 내역에 추가해준다.
  - 주문이 완료된 메뉴들은 장바구니에서 삭제된다.
  - 결제가 승인되지 않는다면 해당 주문은 삭제된다.

- [ ] 한달간 총 구매 금액 + 한달간 주문한 카테고리 별 주문 횟수 조회
  - GET /orderTable/month
  - 사용자는 현재 달의 총 구매 금액, 한달간 주문한 카테고리 별 주문 횟수 조회을 조회할 수 있다.

- [ ] 주문 내역 확인
  - GET /orderTable/list
  - 사용자는 주문한 내역을 확인 할 수 있다.
  - 페이징 처리를 통해 한번에 10개씩 조회 할 수 있다.
  
- [ ] 주문 내역 상세보기
  - GET /orderTable?orderTable={orderId}
  - 사용자는 선택한 주문 내역의 정보를 확인 할 수 있다.

- [ ] 리뷰 작성하기
  - POST /review/{orderId}
  - 사용자는 배달 완료된 상태의 주문에 대해 리뷰를 남길 수 있다. 해당 주문일로부터 3일 내에만 작성 가능하다.
  - 별점 (1 ~ 5), 코멘트, 리뷰 사진을 입력할 수 있고, 코멘트와 리뷰 사진은 입력하지 않아도 된다. 리뷰 사진은 한장만 등록 가능하다.
  - 리뷰 작성이 완료되면 해당 별점이 가게 별점에 적용된다.

- [ ] 리뷰 수정하기
  - PUT /review/{reviewId}
  - 사용자는 작성했던 리뷰를 수정할 수 있다.

- [ ] 리뷰 삭제하기
  - PUT /review/delete/{reviewId}
  - 사용자는 작성했던 리뷰를 삭제할 수 있다. 해당 리뷰의 삭제 날짜가 업데이트 된다.
  - 삭제가 완료되면 해당 가게의 별점이 수정된다.

- [ ] 찜 목록 확인
  - GET /wish
  - 사용자는 찜한 목록을 조회할 수 있다. 추가한 최신 순으로 정렬된다.
  - 페이징 처리를 통해 최대 10개씩 조회 가능하다.

- [ ] 가게 찜하기
  - POST /wish/{storeId}
  - 사용자는 해당 가게를 찜할 수 있다. 해당 가게의 캐싱에 저장된 찜 개수가 1 증가한다.

- [ ] 가게 찜 삭제
  - delete /wish/{wishId}
  - 사용자는 해당 가게의 찜을 삭제할 수 있다. 해당 가게의 캐싱에 저장된 찜 개수가 1 감소한다.

- [ ] 문의 조회
  - GET /inquiries
  - 사용자는 관리자에게 문의한 리스트를 조회할 수 있다. 최신 순으로 정렬된다.
  - 페이징 처리를 통해 최대 10개씩 조회 가능하다.

- [ ] 문의 상세 조회
  - GET /inquiries/{inquiryId}
  - 사용자는 관리자에게 문의한 내역을 상세히 볼 수 있다.
  - 관리자에게 답변이 있는 경우, 답변도 같이 조회 가능하다.

- [ ] 관리자에게 문의 등록
  - POST /inquiries
  - 사용자는 관리자에게 문의할 수 있다. 제목, 내용, 사진을 입력받으며, 사진은 여러장 등록할 수 있다.

- [ ] 문의 수정
  - PUT /inquiries
  - 사용자는 관리자에게 문의한 내용을 수정할 수 있다. 제목, 내용, 사진을 입력받으며, 사진은 여러장 등록할 수 있다.
  - 관리자에게 답변이 있는 경우 수정할 수 없다.

- [ ] 문의 삭제
  - PUT /inquiries/delete
  - 사용자는 관리자에게 문의한 내용을 삭제할 수 있다. 해당 문의의 삭제 날짜가 업데이트 된다.


## 사장님 /partner
- [ ] 회원가입
  - POST /register
  - 사용자는 회원가입 할 수 있다. 사장님 회원은 회원가입 시 partner 권한을 가진다.
  - 회원가입 시 아이디, 비밀번호, 핸드폰 번호, 주소, 이메일을 입력받으며, 비밀번호를 제외한 값들은 unique 해야한다.
    
- [ ] 일반 로그인
  - POST /login
  - 사용자는 로그인 할 수 있다. 로그인 시 아이디와 패스워드가 일치해야 한다.

- [ ] 로그아웃
  - POST /logout
  - 사용자는 로그아웃 할 수 있다. 해당 토큰은 블렉리스트 처리한다.

- [ ] 프로필 수정
  - PUT /profile
  - 사용자는 프로필을 수정 할 수 있다. 비밀번호, 닉네임, 핸드폰 번호, 주소, 이메일을 입력 받는다.

- [ ] 회원 탈퇴
  - PUT /account
  - 사용자는 탈퇴를 할 수 있다. 탈퇴에 성공하면 데이터를 삭제하지 않고, 삭제 날짜를 업데이트 한다.

- [ ] 가게 등록
  - POST /store
  - 사용자는 가게를 등록할 수 있다. 상호명, 전화번호, 주소, 사업자번호, 카테고리, 오픈 시간, 마감 시간, 가게 설명, 최소 주문 금액, 배달비 금액, 원산지 표기, 가게 사진, 가게 프로필 사진을 입력 받을 수 있다.

- [ ] 가게 수정
  - PUT /store
  - 사용자는 가게를 수정할 수 있다. 상호명, 전화번호, 주소, 사업자번호, 카테고리, 오픈 시간, 마감 시간, 가게 설명, 최소 주문 금액, 배달비 금액, 원산지 표기, 가게 사진, 가게 프로필 사진을 입력 받을 수 있다.

- [ ] 가게 삭제
  - PUT /store/delete
  - 사용자는 가게를 삭제 수 있다. 해당 가게의 삭제 날짜가 업데이트 된다.

- [ ] 가게 조회
  - GET /store
  - 사용자는 자신의 가게를 조회할 수 있다. 자신의 가게가 아닌 경우 조회 불가.

- [ ] 가게 메뉴 카테고리 조회
  - GET /store/menu/category
  - 사용자는 자신의 가게의 메뉴 카테고리를 조회할 수 있다. 자신의 가게가 아닌 경우 조회 할 수 없다.
  - 카테고리의 순서 값 순서로 조회된다.

- [ ] 가게 메뉴 카테고리 추가
  - POST /store/menu/category
  - 사용자는 자신의 가게의 메뉴 카테고리를 추가할 수 있다. 카테고리 이름, 순서를 입력받는다.

- [ ] 가게 메뉴 카테고리 수정
  - POST /store/menu/category
  - 사용자는 자신의 가게의 메뉴 카테고리를 수정 수 있다. 카테고리 이름, 순서를 입력받는다.

- [ ] 가게 메뉴 카테고리 삭제
  - DELETE /store/menu/category
  - 사용자는 자신의 가게의 메뉴 카테고리를 삭제할 수 있다. 단, 해당 메뉴 카테고리에 등록된 메뉴가 없어야한다.

- [ ] 가게 메뉴 조회
  - GET /store/menu
  - 사용자는 자신의 가게의 메뉴를 조회할 수 있다. 자신의 가게가 아닌 경우 조회 할 수 없다.

- [ ] 가게 메뉴 상세 조회
  - GET /store/menu/detail?menu={menuId}
  - 사용자는 자신의 가게의 메뉴를 상세 조회할 수 있다. 해당 메뉴와 해당 메뉴의 추가메뉴를 조회할 수 있다.

- [ ] 가게 메뉴 등록
  - POST /store/menu
  - 사용자는 메뉴를 추가할 수 있다. 메뉴 이름, 가격, 설명, 메뉴 카테고리, 메뉴 사진을 입력받는다. 메뉴 사진은 한장만 등록 가능하다.
  - 메뉴 카테고리가 존재가지 않는다면 등록할 수 없다.

- [ ] 가게 메뉴 수정
  - PUT /store/menu
  - 사용자는 메뉴를 수정할 수 있다. 메뉴 이름, 가격, 설명, 메뉴 카테고리, 메뉴 사진을 입력받는다. 메뉴 사진은 한장만 등록 가능하다.

- [ ] 가게 메뉴 삭제
  - PUT /store/menu/delete
  - 사용자는 메뉴를 삭제할 수 있다. 삭제 상태, 삭제 날짜가 업데이트된다.

- [ ] 메뉴 품절 처리
  - PUT /store/menu/{menuId}/stock
  - 사용자는 가게가 오픈 상태일 때 해당 메뉴를 품절 처리 할 수 있다.

- [ ] 추가 메뉴 등록
  - POST /store/menu/{menuId}
  - 사용자는 메뉴에 대한 추가 메뉴를 등록할 수 있다. 추가 메뉴 이름, 가격, 순서를 입력받는다.

- [ ] 추가 메뉴 수정
  - PUT /store/additionalMenu/{additionalMenuId}
  - 사용자는 메뉴에 대한 추가 메뉴를 수정할 수 있다. 추가 메뉴 이름, 가격, 순서를 입력받는다.

- [ ] 추가 메뉴 삭제
  - DELETE /store/additionalMenu/{additionalMenuId}
  - 사용자는 메뉴에 대한 추가 메뉴를 삭제할 수 있다.

- [ ] 주문 조회
  - GET /orderTable/list
  - 사용자는 현재 날짜의 주문을 조회할 수 있다. 최신 순으로 정렬된다.
  - 페이징 처리를 통해 최대 10개씩 조회 가능하다.

- [ ] 주문 상세 조회
  - GET /orderTable/detail?orderTable={orderId}
  - 사용자는 해당 주문을 상세 조회할 수 있다.

- [ ] 배달 완료 처리
  - PUT /orderTable/delivery/{orderId}
  - 사용자는 해당 주문의 배달 완료 처리할 수 있다.

- [ ] 영업 상태 변경(오픈 / 마감)
  - PUT /store/businessStatus
  - 사용자는 영업 상태를 변경할 수 있다. 오픈이면 마감으로, 마감이면 오픈으로 변경된다.
  - 마감으로 바뀐 경우, 품절 처리된 메뉴가 있다면 해당 메뉴의 품절 처리 상태가 품절되지 않은 것으로 변경된다.

- [ ] 리뷰 조회
  - GET /review
  - 사용자는 가게의 리뷰 리스트를 조회할 수 있다. 최신 순으로 정렬된다.
  - 페이징 처리를 통해 최대 10개씩 조회 가능하다.

- [ ] 리뷰 상세 조회
  - GET /review/detail?review={reviewId}
  - 사용자는 해당 리뷰를 상세 조회할 수 있다.
  - 사용자가 답변을 작성한 경우, 답변도 같이 조회 가능하다.

- [ ] 리뷰 답변 등록
  - POST /reviewAnswer
  - 사용자는 해당 리뷰에 답변을 등록할 수 있다. 코멘트를 입력받는다.

- [ ] 리뷰 답변 수정
  - PUT /reviewAnswer
  - 사용자는 리뷰 답변을 수정할 수 있다. 코멘트를 입력받는다.
  - 관리자에게 답변이 있는 경우 수정할 수 없다.

- [ ] 리뷰 답변 삭제
  - PUT /reviewAnswer/delete
  - 사용자는 관리자에게 문의한 내용을 삭제할 수 있다. 해당 리뷰 답변의 삭제 날짜가 업데이트 된다.

- [ ] 문의 조회
  - GET /inquiries/list
  - 사용자는 관리자에게 문의한 리스트를 조회할 수 있다. 최신 순으로 정렬된다.
  - 페이징 처리를 통해 최대 10개씩 조회 가능하다.

- [ ] 문의 상세 조회
  - GET /inquiries/{inquiryId}
  - 사용자는 관리자에게 문의한 내역을 상세히 볼 수 있다.
  - 관리자에게 답변이 있는 경우, 답변도 같이 조회 가능하다.

- [ ] 관리자에게 문의 등록
  - POST /inquiries
  - 사용자는 관리자에게 문의할 수 있다. 제목, 내용, 사진을 입력받으며, 사진은 여러장 등록할 수 있다.

- [ ] 문의 수정
  - PUT /inquiries
  - 사용자는 관리자에게 문의한 내용을 수정할 수 있다. 제목, 내용, 사진을 입력받으며, 사진은 여러장 등록할 수 있다.
  - 관리자에게 답변이 있는 경우 수정할 수 없다.

- [ ] 문의 삭제
  - PUT /inquiries/delete
  - 사용자는 관리자에게 문의한 내용을 삭제할 수 있다. 해당 문의의 삭제 날짜가 업데이트 된다.
      
## 관리자 /admin (2순위)

- [ ] 일반 회원 리스트 조회
  - GET /user/list
  - 관리자는 일반 회원 리스트를 조회할 수 있다.

- [ ] 사장님 리스트 조회
  - GET /partner/list
  - 관리자는 사장님들의 리스트를 조회할 수 있다.

- [ ] 가게 리스트 조회
  - GET /store/list
  - 관리자는 가게 리스트를 조회할 수 있다. 가게 전체 조회와 허가가 안난 가게 리스트 조회 (?access_status=false) 중 선택할 수 있다.

- [ ] 가게 상세 조회
  - GET /store/{storeId}
  - 관리자는 가게 상세 조회할 수 있다. 가게 상세 정보와 함께 해당 가게의 파트너 정보도 같이 조회된다.

- [ ] 가게 허가 수정
  - PUT /store/authorized/{storeId}
  - 관리자는 가게 허가를 수정할 수 있다. 허가된 상태라면 허가 안된 상태로, 허가되지 않은 상태라면 허가 상태로 바꾼다.

- [ ] 문의 내역 조회
  - GET /inquiries/list
  - 관리자는 문의 내역 리스트를 조회할 수 있다. 문의 내역 전체 조회와 답변을 달지 않은 문의 내역 조회 (?answered=false) 중 선택할 수 있다.

- [ ] 문의 내역 상세 조회
  - GET /inquiries/detail?inquiry={inquiriesId}
  - 관리자는 문의 내역을 상세 조회할 수 있다. 답변을 등록한 경우 답변도 함께 조회된다.

- [ ] 문의 답변 등록
  - POST /inquiries/{inquiriesId}
  - 관리자는 문의 내역에 답변을 등록할 수 있다. 제목, 내용, 사진을 입력받는다.

- [ ] 문의 답변 수정
  - PUT /inquiries/answer/{inquiredAnswerId}
  - 관리자는 문의 내역에 답변을 수정할 수 있다. 제목, 내용, 사진을 입력받는다.

- [ ] 문의 답변 삭제
  - PUT /inquiries/answer/delete/{inquiredAnswerId}
  - 관리자는 문의 내역에 답변을 삭제할 수 있다. 삭제 날짜가 업데이트 된다.


# ERD
![delivery](https://github.com/ykchoi1203/DeliveryService/assets/30820741/b60dbe06-fa96-4f37-82dd-9ff7497f34ff)


## Trouble Shooting
[go to the trouble shooting section](TROUBLE_SHOOTING.md)
